<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>생존! 내가 살아남는다</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html, body { background:#f7fafc }
  </style>
</head>
<body class="min-h-screen">
  <div id="root"></div>

  <script type="text/babel">
// ----- 데이터: 아이템 (비상식량 전부 size=1) -----
const ITEMS = [
  { id:'water', name:'생수(500ml)', size:1, description:'깨끗한 식수 1병' },
  { id:'food', name:'비상식량', size:1, description:'통조림, 에너지바 등' },
  { id:'ramen', name:'라면', size:1, description:'간편 식사' },
  { id:'choco', name:'초콜릿', size:1, description:'빠른 에너지 보충' },
  { id:'flashlight', name:'손전등', size:1, description:'배터리 포함' },
  { id:'radio', name:'라디오', size:2, description:'건전지식 휴대용 라디오' },
  { id:'firstaid', name:'구급상자', size:2, description:'기본 응급처치 도구' },
  { id:'emergency_blanket', name:'비상담요', size:1, description:'보온용 은박 담요' },
  { id:'whistle', name:'호루라기', size:1, description:'구조 신호용' },
  { id:'charger', name:'충전기', size:1, description:'휴대폰 충전기' },
  { id:'phone', name:'스마트폰', size:1, description:'통신 및 정보 확인용' },
  { id:'blanket', name:'이불', size:5, description:'보온용 침구' },
  { id:'hat', name:'모자', size:1, description:'방한용' },
  { id:'raincoat', name:'우비', size:1, description:'방수 우의' },
  { id:'tissue', name:'휴지', size:1, description:'화장지' },
  { id:'gasmask', name:'방독면', size:2, description:'유독가스 차단용' },
  { id:'knife', name:'칼', size:1, description:'다목적 칼' },
  { id:'tape', name:'테이프', size:1, description:'다용도 테이프' },
  { id:'lighter', name:'점화도구', size:1, description:'라이터, 성냥' },
  { id:'photo', name:'가족사진', size:1, description:'가족 사진' },
  { id:'map', name:'지도', size:1, description:'지역 지도' },
  { id:'salad', name:'샐러드', size:2, description:'신선 채소' },
];

// ----- 데이터: 단계 (활동지 흐름 요약) -----
const PHASES = [
  {
    key:'t3',
    title:'📍 사건 발생 3시간 후',
    tasks:[
      '🥛 물(500ml) 1병 소비 → 가방에서 물 1개 클릭해 지우세요. 없으면 점수 -1',
      '🍙 식량 1개 소비(비상식량/라면/초콜릿 중 아무거나 1개) → 없으면 점수 -1',
      '📻 소식 확인(라디오 또는 스마트폰 있으면 유지, 없으면 점수 -1)'
    ],
    tips:'물, 식량 1개씩 지우고, 소식 여부에 따라 점수 조정하세요.'
  },
  {
    key:'t7',
    title:'📍 사건 발생 7시간 후 (비가 내림)',
    tasks:[
      '❄️ 체온 유지: 이불/모자/우비/비상담요 중 1개 보유 → 유지, 없으면 점수 -1',
      '💧 이불은 젖어 사용 불가 → 가방에 있으면 이불 제거',
      '🤒 병 기운 → 구급상자 있으면 유지, 없으면 점수 -1'
    ],
    tips:'체온유지 아이템 확인, 이불 삭제, 구급상자 여부로 점수 조정.'
  },
  {
    key:'t15',
    title:'📍 사건 발생 15시간 후',
    tasks:[
      '🔥 불 피우기: 점화도구(라이터/성냥) 있으면 점수 +1, 없으면 변화 없음'
    ],
    tips:'점화도구가 있으면 +1을 누르세요.'
  },
  {
    key:'t24',
    title:'📍 사건 발생 24시간 후',
    tasks:[
      '🔌 충전기 없으면 스마트폰 사용 불가 → 충전기 없다면 스마트폰 삭제',
      '🥗 샐러드 상함 → 샐러드 삭제',
      '🥛 물 1병 소비 → 없으면 점수 -1',
      '🍙 식량 1개 소비 → 없으면 점수 -1',
      '📻 소식 듣기: 라디오/스마트폰 있으면 점수 +1'
    ],
    tips:'삭제할 것(샐러드, 폰) 지우고 물/식량 소비, 소식 있으면 +1.'
  },
  {
    key:'t30',
    title:'📍 사건 발생 30시간 후',
    tasks:[
      '☁️ 유독가스: 방독면 있으면 유지, 없으면 점수 -1',
      '🗺️ 지도로 탐험(지도 있을 때만 선택 가능): 보상은 수업에서 구두 안내',
      '🧻 휴지 있으면 위생 유지, 없으면 점수 -1'
    ],
    tips:'방독면/휴지 여부로 점수 조정. 지도는 선택지 안내용.'
  },
  {
    key:'t39',
    title:'📍 사건 발생 39시간 후 (어둠과 소리)',
    tasks:[
      '🔦 손전등 있으면 위험 회피, 없으면 점수 -1'
    ],
    tips:'손전등 없으면 -1.'
  },
  {
    key:'t48',
    title:'📍 사건 발생 48시간 후',
    tasks:[
      '🥛 물 1병 소비 → 없으면 점수 -1',
      '🍙 식량 1개 소비 → 없으면 점수 -1',
      '📻 라디오로 구조대 소식 → 라디오 있으면 점수 +1'
    ],
    tips:'물/식량 지우고, 라디오 있으면 +1.'
  },
  {
    key:'t56',
    title:'📍 사건 발생 56시간 후',
    tasks:[
      '🥛 물 1병 소비 → 없으면 점수 -1',
      '🛠️ 수리: 칼 또는 테이프 있으면 점수 +1'
    ],
    tips:'물 지우고, 칼/테이프 있으면 +1.'
  },
  {
    key:'t64',
    title:'📍 사건 발생 64시간 후 (구조 신호)',
    tasks:[
      '📣 호루라기 있으면 점수 +1 (없으면 변화 없음)'
    ],
    tips:'호루라기 있으면 +1.'
  },
  {
    key:'t72',
    title:'📍 사건 발생 72시간 후 (구조대 도착)',
    tasks:[
      '👪 가족사진 있으면 가족을 찾는데 도움 (점수 변화 없음)'
    ],
    tips:'마무리 단계! 결과를 확인하세요.'
  }
];

// ----- 유틸 -----
const fmtCount = n => (n>1 ? ` × ${n}` : "");

// ----- 메인 컴포넌트 -----
function App() {
  const [page, setPage] = React.useState('intro');
  const [selected, setSelected] = React.useState([]); // 아이템 배열
  const [score, setScore] = React.useState(10);       // 시작점 10점
  const [phaseIdx, setPhaseIdx] = React.useState(0);
  const [reason, setReason] = React.useState("");

  const used = selected.reduce((s, it) => s + it.size, 0);
  const remaining = 20 - used;

  // 그룹화
  const grouped = selected.reduce((acc, it) => {
    const f = acc.find(a => a.id === it.id);
    if (f) f.count += 1; else acc.push({...it, count:1});
    return acc;
  }, []);

  // 담기
  const addItem = (item) => {
    if (remaining - item.size < 0) return alert('가방에 공간이 부족합니다!');
    setSelected([...selected, item]);
  };

  // 하나 빼기 (인벤토리에서)
  const removeOneById = (id) => {
    const idx = selected.findIndex(i => i.id === id);
    if (idx !== -1) {
      const c = [...selected]; c.splice(idx,1); setSelected(c);
    }
  };

  const goSim = () => setPage('sim');
  const goResult = () => setPage('result');

  const currentPhase = PHASES[phaseIdx];

  return (
    <div className="max-w-6xl mx-auto p-4 md:p-8">
      {page === 'intro' && (
        <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8">
          <div className="flex items-center gap-3 mb-4">
            <div className="text-3xl">🚨</div>
            <h1 className="text-3xl md:text-4xl font-extrabold text-gray-800">생존! 내가 살아남는다</h1>
          </div>

          <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-xl mb-6">
            <p className="text-gray-800 leading-relaxed">
              재난이 발생했습니다. 구조대가 올 때까지 72시간을 버텨야 합니다.<br/>
              <b>가방 용량 20칸</b> 안에서 필요한 물건을 선택하세요. (비상식량은 모두 1칸)
            </p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="md:col-span-2 bg-white rounded-2xl border p-4">
              <h2 className="font-bold text-lg mb-3">선택 가능한 물건</h2>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-[540px] overflow-y-auto pr-2">
                {ITEMS.map(item => (
                  <button key={item.id}
                    onClick={() => addItem(item)}
                    className="text-left p-3 rounded-lg border hover:shadow transition bg-white">
                    <div className="flex justify-between">
                      <span className="font-semibold text-sm text-gray-800">{item.name}</span>
                      <span className="text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full">{item.size}칸</span>
                    </div>
                    <div className="text-xs text-gray-600 mt-1">{item.description}</div>
                  </button>
                ))}
              </div>
            </div>

            <div className="bg-white rounded-2xl border p-4">
              <h2 className="font-bold text-lg mb-2">내 생존가방 🎒</h2>
              <div className="grid grid-cols-3 gap-2 text-center mb-3">
                <div className="bg-blue-100 rounded p-2">
                  <div className="text-xs text-blue-800">사용</div>
                  <div className="font-bold text-xl text-blue-900">{used}</div>
                </div>
                <div className="bg-green-100 rounded p-2">
                  <div className="text-xs text-green-800">남은</div>
                  <div className="font-bold text-xl text-green-900">{remaining}</div>
                </div>
                <div className="bg-purple-100 rounded p-2">
                  <div className="text-xs text-purple-800">갯수</div>
                  <div className="font-bold text-xl text-purple-900">{selected.length}</div>
                </div>
              </div>
              <div className="max-h-72 overflow-y-auto">
                {grouped.length === 0 ? (
                  <div className="text-gray-400 text-center py-8">물건을 클릭해 담아보세요!</div>
                ) : (
                  grouped.map(it => (
                    <div key={it.id} className="flex items-center justify-between bg-gray-50 border rounded p-2 mb-2">
                      <div>
                        <div className="font-semibold text-sm text-gray-800">{it.name}{fmtCount(it.count)}</div>
                        <div className="text-xs text-gray-500">{it.size}칸 × {it.count}개 = {it.size*it.count}칸</div>
                      </div>
                      <div className="flex items-center gap-1">
                        <button className="px-2 py-1 text-sm rounded bg-red-100 text-red-700 hover:bg-red-200"
                                onClick={() => removeOneById(it.id)}>-1</button>
                        <button className="px-2 py-1 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300"
                                onClick={() => addItem(ITEMS.find(x=>x.id===it.id))}>+1</button>
                      </div>
                    </div>
                  ))
                )}
              </div>

              <button
                disabled={selected.length===0}
                onClick={goSim}
                className="mt-4 w-full py-3 rounded-xl text-white font-bold shadow
                           disabled:opacity-50 disabled:cursor-not-allowed
                           bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700">
                준비 완료 → 시뮬레이션 시작
              </button>
            </div>
          </div>
        </div>
      )}

      {page === 'sim' && (
        <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8">
          <div className="flex items별한 justify-between mb-4">
            <h2 className="text-2xl md:text-3xl font-extrabold text-gray-800">시뮬레이션 진행</h2>
            <div className="flex items-center gap-3">
              <div className="px-3 py-1 rounded-full bg-rose-100 text-rose-700 font-bold">점수 ❤️ {score}</div>
              <button onClick={() => setScore(s => s-1)}
                      className="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">-1</button>
              <button onClick={() => setScore(s => s+1)}
                      className="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">+1</button>
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div className="md:col-span-2">
              <div className="rounded-2xl border p-4 bg-orange-50">
                <div className="text-xl md:text-2xl font-bold mb-2">{currentPhase.title}</div>
                <ul className="list-disc pl-5 space-y-2 text-gray-800">
                  {currentPhase.tasks.map((t,i)=>(
                    <li key={i}>{t}</li>
                  ))}
                </ul>
                <div className="mt-3 text-sm text-gray-600">💡 {currentPhase.tips}</div>
              </div>

              <div className="flex justify-between mt-4">
                <button
                  onClick={() => setPhaseIdx(i => Math.max(0, i-1))}
                  className="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">
                  ← 이전 단계
                </button>
                {phaseIdx < PHASES.length-1 ? (
                  <button
                    onClick={() => setPhaseIdx(i => Math.min(PHASES.length-1, i+1))}
                    className="px-4 py-2 rounded text-white font-bold bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600">
                    다음 단계 →
                  </button>
                ) : (
                  <button
                    onClick={goResult}
                    className="px-4 py-2 rounded text-white font-bold bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700">
                    결과 보기 →
                  </button>
                )}
              </div>
            </div>

            <div>
              <div className="rounded-2xl border p-4 bg-white">
                <h3 className="font-bold mb-2">내 생존가방 🎒</h3>
                <div className="grid grid-cols-3 gap-2 text-center mb-3">
                  <div className="bg-blue-100 rounded p-2">
                    <div className="text-xs text-blue-800">사용</div>
                    <div className="font-bold text-xl text-blue-900">{used}</div>
                  </div>
                  <div className="bg-green-100 rounded p-2">
                    <div className="text-xs text-green-800">남은</div>
                    <div className="font-bold text-xl text-green-900">{20-used}</div>
                  </div>
                  <div className="bg-purple-100 rounded p-2">
                    <div className="text-xs text-purple-800">갯수</div>
                    <div className="font-bold text-xl text-purple-900">{selected.length}</div>
                  </div>
                </div>

                <div className="max-h-72 overflow-y-auto">
                  {grouped.length === 0 ? (
                    <div className="text-gray-400 text-center py-8">가방이 비었습니다.</div>
                  ) : (
                    grouped.map(it => (
                      <div key={it.id} className="flex items-center justify-between bg-gray-50 border rounded p-2 mb-2">
                        <div>
                          <div className="font-semibold text-sm text-gray-800">{it.name}{fmtCount(it.count)}</div>
                          <div className="text-xs text-gray-500">{it.size}칸 × {it.count}개 = {it.size*it.count}칸</div>
                        </div>
                        <div className="flex items-center gap-1">
                          <button className="px-2 py-1 text-sm rounded bg-red-100 text-red-700 hover:bg-red-200"
                                  onClick={() => removeOneById(it.id)}>-1</button>
                          <button className="px-2 py-1 text-sm rounded bg-gray-200 text-gray-700 hover:bg-gray-300"
                                  onClick={() => addItem(ITEMS.find(x=>x.id===it.id))}>+1</button>
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {page === 'result' && (
        <div className="bg-white rounded-2xl shadow-2xl p-6 md:p-8">
          <div className="text-center mb-6">
            <div className="text-4xl font-extrabold mb-2">최종 생존 점수</div>
            <div className="inline-block px-8 py-4 rounded-2xl text-white text-5xl font-black
                            bg-gradient-to-r from-emerald-500 to-green-600 shadow">
              {score}점
            </div>
            <div className="mt-3 text-xl font-bold">
              {score>0 ? "✅ 생존 성공!" : "❌ 생존 실패..."}
            </div>
          </div>

          <div className="mb-6">
            <h3 className="font-bold text-lg mb-2">내가 선택한 물품</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              {grouped.map(it => (
                <div key={it.id} className="p-3 rounded-lg border bg-gray-50">
                  <div className="flex items-center justify-between">
                    <div className="font-semibold text-gray-800">{it.name}{fmtCount(it.count)}</div>
                    <span className="text-xs bg-blue-600 text-white px-2 py-0.5 rounded-full">
                      {it.size*it.count}칸
                    </span>
                  </div>
                  <div className="text-xs text-gray-600 mt-1">{ITEMS.find(x=>x.id===it.id)?.description || ""}</div>
                </div>
              ))}
            </div>
          </div>

          <div className="mb-6">
            <h3 className="font-bold text-lg mb-2">선택 이유 적기 ✏️</h3>
            <textarea
              className="w-full border rounded-lg p-3 min-h-[120px] outline-none focus:ring-2 focus:ring-emerald-400"
              placeholder="왜 이 물건들을 선택했나요? 상황별로 어떤 도움이 되었나요?"
              value={reason}
              onChange={(e)=>setReason(e.target.value)}
            ></textarea>
          </div>

          <div className="flex flex-wrap gap-2 justify-between">
            <button
              onClick={() => { setPage('intro'); setSelected([]); setScore(10); setPhaseIdx(0); setReason(""); }}
              className="px-4 py-3 rounded-xl text-white font-bold bg-gray-500 hover:bg-gray-600">
              처음으로
            </button>
            <button
              onClick={() => navigator.clipboard.writeText(`생존점수: ${score}점\n선택 이유: ${reason}`)}
              className="px-4 py-3 rounded-xl text-white font-bold bg-blue-600 hover:bg-blue-700">
              결과 복사하기
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
  </script>
</body>
</html>
